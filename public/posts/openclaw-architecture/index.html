<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>OpenClaw 架构深潜：打造生产级个人 AI 助手网关 | Lumi&#39;s Tech Blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="拆解 OpenClaw Gateway 的消息流、工具桥、扩展插件与多端同步策略，帮助自建 AI 助手的工程师掌握生产级架构要点。">
    <meta name="generator" content="Hugo 0.111.3">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="/lumi-tech-blog/ananke/css/main.min.css" >



    <script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
  
  
  document.addEventListener('DOMContentLoaded', () => {
    const codeBlocks = document.querySelectorAll('pre > code.language-mermaid');
    codeBlocks.forEach((block) => {
      const pre = block.parentElement;
      const content = block.textContent;
      const div = document.createElement('div');
      div.className = 'mermaid';
      div.textContent = content;
      pre.replaceWith(div);
    });
    mermaid.run();
  });
</script>

    
    
      

    

    
    
    <meta property="og:title" content="OpenClaw 架构深潜：打造生产级个人 AI 助手网关" />
<meta property="og:description" content="拆解 OpenClaw Gateway 的消息流、工具桥、扩展插件与多端同步策略，帮助自建 AI 助手的工程师掌握生产级架构要点。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Lumicreator.github.io/lumi-tech-blog/posts/openclaw-architecture/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2026-02-01T16:40:00+08:00" />
<meta property="article:modified_time" content="2026-02-01T16:40:00+08:00" />
<meta itemprop="name" content="OpenClaw 架构深潜：打造生产级个人 AI 助手网关">
<meta itemprop="description" content="拆解 OpenClaw Gateway 的消息流、工具桥、扩展插件与多端同步策略，帮助自建 AI 助手的工程师掌握生产级架构要点。"><meta itemprop="datePublished" content="2026-02-01T16:40:00+08:00" />
<meta itemprop="dateModified" content="2026-02-01T16:40:00+08:00" />
<meta itemprop="wordCount" content="1710">
<meta itemprop="keywords" content="AI,OpenClaw,Architecture,Gateway," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="OpenClaw 架构深潜：打造生产级个人 AI 助手网关"/>
<meta name="twitter:description" content="拆解 OpenClaw Gateway 的消息流、工具桥、扩展插件与多端同步策略，帮助自建 AI 助手的工程师掌握生产级架构要点。"/>

	<style>
   
  .prose table, .nested-copy-line-height table {
    border-collapse: collapse;
    width: 100%;
    margin-bottom: 2rem;
    border: 1px solid #444;
    background-color: #1a1a1a;
    color: #eee;
  }
  .prose th, .prose td, .nested-copy-line-height th, .nested-copy-line-height td {
    padding: 12px 15px;
    text-align: left;
    border: 1px solid #444;
  }
  .prose th, .nested-copy-line-height th {
    background-color: #333;
    font-weight: bold;
    color: #fff;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.05em;
  }
  .prose tr:nth-child(even), .nested-copy-line-height tr:nth-child(even) {
    background-color: #222;
  }
  .prose tr:hover, .nested-copy-line-height tr:hover {
    background-color: #2a2a2a;
  }
   
  .prose td code, .nested-copy-line-height td code {
    background-color: #333;
    padding: 2px 4px;
    border-radius: 4px;
    color: #ffb86c;
  }
</style>

  </head>

  <body class="ma0 avenir bg-near-white DEV">

    
   
  

  
  <header class="cover bg-top" style="background-image: url('https://Lumicreator.github.io/lumi-tech-blog/openclaw-architecture-main.png');">
    <div class="bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/lumi-tech-blog/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Lumi&#39;s Tech Blog
      
    </a>
    <div class="flex-l items-center">
      

      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">OpenClaw 架构深潜：打造生产级个人 AI 助手网关</h1>
          
            <h2 class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">
              拆解 OpenClaw Gateway 的消息流、工具桥、扩展插件与多端同步策略，帮助自建 AI 助手的工程师掌握生产级架构要点。
            </h2>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">OpenClaw 架构深潜：打造生产级个人 AI 助手网关</h1>
      
      <p class="tracked">
        By <strong>Lumi</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2026-02-01T16:40:00+08:00">February 1, 2026</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id="openclaw-架构深潜打造生产级个人-ai-助手网关">OpenClaw 架构深潜：打造生产级个人 AI 助手网关</h1>
<blockquote>
<p><em>&ldquo;EXFOLIATE! EXFOLIATE!&rdquo;</em> — 太空龙虾 Molty</p>
</blockquote>
<p><img src="https://Lumicreator.github.io/lumi-tech-blog/openclaw-architecture-main.png" alt="架构图"></p>
<h2 id="引言">引言</h2>
<p>OpenClaw 是一个开源的个人 AI 助手框架，它将现代大型语言模型与人们日常使用的消息渠道无缝连接——WhatsApp、Telegram、Slack、Discord、Signal、iMessage 等。与云托管的 AI 助手不同，OpenClaw 运行在您自己的基础设施上，让您完全掌控数据、会话和工具执行。</p>
<p>本文为高级开发者和架构师提供 OpenClaw 系统的全面架构分析，帮助您理解如何构建、部署和扩展生产级 AI 助手基础设施。</p>
<p><strong>代码仓库</strong>：<a href="https://github.com/openclaw/openclaw">github.com/openclaw/openclaw</a></p>
<hr>
<h2 id="目录">目录</h2>
<ol>
<li><a href="#%E9%AB%98%E5%B1%82%E6%9E%B6%E6%9E%84">高层架构</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6">核心组件</a>
<ul>
<li><a href="#%E7%BD%91%E5%85%B3%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2">网关（控制平面）</a></li>
<li><a href="#agent-%E8%BF%90%E8%A1%8C%E6%97%B6">Agent 运行时</a></li>
<li><a href="#%E4%BC%9A%E8%AF%9D">会话</a></li>
<li><a href="#%E6%B8%A0%E9%81%93">渠道</a></li>
<li><a href="#%E6%8A%80%E8%83%BD">技能</a></li>
<li><a href="#%E8%8A%82%E7%82%B9">节点</a></li>
</ul>
</li>
<li><a href="#%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE">通信协议</a></li>
<li><a href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">运行时工作流程</a></li>
<li><a href="#%E5%A4%9A-agent-%E6%9E%B6%E6%9E%84">多 Agent 架构</a></li>
<li><a href="#%E5%AE%89%E5%85%A8%E6%A8%A1%E5%9E%8B">安全模型</a></li>
<li><a href="#%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7">可扩展性</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%BC%8F">部署模式</a></li>
<li><a href="#cli-%E5%8F%82%E8%80%83">CLI 参考</a></li>
<li><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E8%A6%81%E7%82%B9">核心要点</a></li>
<li><a href="#%E6%9C%AA%E6%9D%A5%E8%B7%AF%E7%BA%BF%E5%9B%BE">未来路线图</a></li>
</ol>
<hr>
<h2 id="高层架构">高层架构</h2>
<p>OpenClaw 采用<strong>以网关为中心的架构</strong>，由单个长期运行的进程管理所有渠道连接，并作为客户端、工具和自动化的控制平面。</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TD
    subgraph Channels [消息渠道]
        WA[WhatsApp]
        TG[Telegram]
        DC[Discord]
        SL[Slack]
        IM[iMessage]
    end

    subgraph Gateway [OpenClaw Gateway 控制平面]
        direction TB
        Router[Agent 路由器]
        SessionMgr[会话管理器]
        ToolExec[工具执行器]
        Cron[定时调度器]
        Canvas[Canvas 主机]
        
        Router --- SessionMgr
        SessionMgr --- ToolExec
    end

    subgraph Clients [客户端与节点]
        CLI[CLI 命令行]
        App[macOS 菜单栏应用]
        Nodes[设备节点 iOS/Android]
    end

    Channels ==&gt; Gateway
    Gateway &lt;==&gt; Clients
    ToolExec -.-&gt; Sandbox[Docker 沙箱]
</code></pre><h3 id="核心设计原则">核心设计原则</h3>
<ol>
<li><strong>单一事实来源</strong>：每台主机一个网关实例，独占所有渠道会话（这对 WhatsApp 的单会话限制尤为关键）</li>
<li><strong>默认本地回环</strong>：网关默认绑定至 <code>127.0.0.1:18789</code>，远程访问需显式配置</li>
<li><strong>协议优先</strong>：所有通信采用带 JSON Schema 验证的类型化 WebSocket 协议</li>
<li><strong>确定性路由</strong>：响应消息确定性地返回至来源渠道，无需模型参与路由决策</li>
<li><strong>本地优先</strong>：专为个人使用设计，会话状态持久化存储于本地</li>
</ol>
<hr>
<h2 id="核心组件">核心组件</h2>
<h3 id="网关控制平面">网关（控制平面）</h3>
<p>网关是 OpenClaw 的核心——一个 Node.js 进程，负责：</p>
<ul>
<li><strong>管理所有渠道连接</strong>（WhatsApp 通过 Baileys、Telegram 通过 grammY 等）</li>
<li><strong>暴露 WebSocket API</strong> 供客户端、自动化和设备节点使用</li>
<li><strong>路由消息</strong> 在渠道和 Agent 之间</li>
<li><strong>管理会话状态</strong> 和持久化</li>
<li><strong>执行工具</strong>（在主机或 Docker 沙箱中）</li>
</ul>
<h4 id="启动网关">启动网关</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 基本启动</span>
</span></span><span style="display:flex;"><span>openclaw gateway --port <span style="color:#ae81ff">18789</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启用详细日志</span>
</span></span><span style="display:flex;"><span>openclaw gateway --port <span style="color:#ae81ff">18789</span> --verbose
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 强制终止现有监听并启动</span>
</span></span><span style="display:flex;"><span>openclaw gateway --force
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 开发模式（隔离状态）</span>
</span></span><span style="display:flex;"><span>openclaw --dev gateway --allow-unconfigured
</span></span></code></pre></div><h4 id="配置文件位置">配置文件位置</h4>
<pre tabindex="0"><code>~/.openclaw/openclaw.json   # 主配置（JSON5 格式）
~/.openclaw/workspace       # Agent 工作区
~/.openclaw/credentials     # 渠道凭证
~/.openclaw/agents/&lt;id&gt;     # 每个 Agent 的状态
</code></pre><h4 id="最小配置示例">最小配置示例</h4>
<pre tabindex="0"><code class="language-json5" data-lang="json5">// ~/.openclaw/openclaw.json
{
  agent: {
    model: &#34;anthropic/claude-opus-4-5&#34;
  },
  agents: {
    defaults: {
      workspace: &#34;~/.openclaw/workspace&#34;
    }
  },
  channels: {
    whatsapp: {
      dmPolicy: &#34;allowlist&#34;,
      allowFrom: [&#34;+15551234567&#34;]
    }
  }
}
</code></pre><p>网关支持通过文件系统监听实现配置热重载。默认模式（<code>gateway.reload.mode=&quot;hybrid&quot;</code>）会热应用安全变更，并在关键变更时触发重启。</p>
<hr>
<h3 id="agent-运行时">Agent 运行时</h3>
<p>OpenClaw 使用 <strong>Pi</strong> 作为其内嵌 Agent 运行时。Agent 循环处理：</p>
<ol>
<li>从渠道<strong>接收消息</strong></li>
<li><strong>组装上下文</strong>（系统提示、技能、会话历史）</li>
<li>通过配置的提供商进行<strong>模型推理</strong></li>
<li>带流式输出的<strong>工具执行</strong></li>
<li>将<strong>会话持久化</strong>至 JSONL 格式的记录文件</li>
</ol>
<h4 id="agent-循环生命周期">Agent 循环生命周期</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">sequenceDiagram
    participant Ch as 渠道
    participant G as 网关
    participant A as Agent (Pi)
    participant M as 模型
    participant T as 工具/沙箱

    Ch-&gt;&gt;G: 接收入站消息
    G-&gt;&gt;G: 解析会话 &amp; 路由
    G-&gt;&gt;A: 启动 Agent 轮次
    A-&gt;&gt;M: 携带上下文进行推理
    M--&gt;&gt;A: 吐出思考流
    A--&gt;&gt;G: 实时流式转发给用户
    
    opt 工具调用
        M-&gt;&gt;A: 请求执行工具
        A-&gt;&gt;T: 执行命令
        T--&gt;&gt;A: 返回执行结果
        A-&gt;&gt;M: 将结果喂回模型
        M--&gt;&gt;A: 最终总结
    end

    A-&gt;&gt;G: 任务完成
    G-&gt;&gt;Ch: 发送最终响应
    G-&gt;&gt;G: 持久化会话记录
</code></pre><h4 id="关键事件类型">关键事件类型</h4>
<table>
<thead>
<tr>
<th>流</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>lifecycle</code></td>
<td>阶段转换（<code>start</code>、<code>end</code>、<code>error</code>）</td>
</tr>
<tr>
<td><code>assistant</code></td>
<td>流式模型输出增量</td>
</tr>
<tr>
<td><code>tool</code></td>
<td>工具开始/更新/结束事件</td>
</tr>
<tr>
<td><code>compaction</code></td>
<td>会话压缩事件</td>
</tr>
</tbody>
</table>
<h4 id="并发控制">并发控制</h4>
<p>每个会话的运行通过队列系统串行化。这可以防止工具/会话竞态条件，并保持历史记录一致性。消息渠道可配置队列模式：</p>
<ul>
<li><code>collect</code>：批量收集多条消息</li>
<li><code>steer</code>：优先级路由</li>
<li><code>followup</code>：链式响应</li>
</ul>
<hr>
<h3 id="会话">会话</h3>
<p>会话跟踪用户与 Agent 之间的对话状态。OpenClaw 采用精细的会话模型：</p>
<h4 id="会话键结构">会话键结构</h4>
<pre tabindex="0"><code># 私聊（默认：合并至主会话）
agent:&lt;agentId&gt;:&lt;mainKey&gt;

# 按对端隔离
agent:&lt;agentId&gt;:dm:&lt;peerId&gt;

# 按渠道-对端隔离
agent:&lt;agentId&gt;:&lt;channel&gt;:dm:&lt;peerId&gt;

# 群组（始终隔离）
agent:&lt;agentId&gt;:&lt;channel&gt;:group:&lt;groupId&gt;

# Telegram 论坛主题
agent:&lt;agentId&gt;:telegram:group:&lt;chatId&gt;:topic:&lt;threadId&gt;

# 自动化
cron:&lt;jobId&gt;
hook:&lt;uuid&gt;
</code></pre><h4 id="会话配置">会话配置</h4>
<pre tabindex="0"><code class="language-json5" data-lang="json5">{
  session: {
    // 私聊分组方式
    dmScope: &#34;main&#34;,        // 选项：main, per-peer, per-channel-peer

    // 重置策略
    reset: {
      mode: &#34;daily&#34;,
      atHour: 4,            // 本地时间凌晨 4 点
      idleMinutes: 120      // 或基于空闲时间
    },

    // 按类型覆盖
    resetByType: {
      dm: { mode: &#34;idle&#34;, idleMinutes: 240 },
      group: { mode: &#34;daily&#34;, atHour: 4 }
    },

    // 身份关联（跨渠道识别同一用户）
    identityLinks: {
      alice: [&#34;telegram:123456789&#34;, &#34;discord:987654321012345678&#34;]
    }
  }
}
</code></pre><h4 id="存储布局">存储布局</h4>
<pre tabindex="0"><code>~/.openclaw/agents/&lt;agentId&gt;/
├── sessions/
│   ├── sessions.json           # 会话元数据存储
│   ├── &lt;sessionId&gt;.jsonl       # 记录日志
│   └── &lt;sessionId&gt;-topic-&lt;threadId&gt;.jsonl
└── agent/
    └── auth-profiles.json      # 每个 Agent 的模型凭证
</code></pre><hr>
<h3 id="渠道">渠道</h3>
<p>渠道是 OpenClaw 连接的消息平台。每个渠道都有独立的适配器：</p>
<table>
<thead>
<tr>
<th>渠道</th>
<th>库</th>
<th>特性</th>
</tr>
</thead>
<tbody>
<tr>
<td>WhatsApp</td>
<td>Baileys</td>
<td>Web 协议、多账号、媒体</td>
</tr>
<tr>
<td>Telegram</td>
<td>grammY</td>
<td>Bot API、Webhooks、群组、主题</td>
</tr>
<tr>
<td>Discord</td>
<td>discord.js</td>
<td>服务器、私聊、帖子</td>
</tr>
<tr>
<td>Slack</td>
<td>Bolt</td>
<td>工作区、频道、帖子</td>
</tr>
<tr>
<td>Signal</td>
<td>signal-cli</td>
<td>端到端加密</td>
</tr>
<tr>
<td>iMessage</td>
<td>imsg (macOS)</td>
<td>原生 macOS 集成</td>
</tr>
<tr>
<td>WebChat</td>
<td>内置</td>
<td>基于浏览器的界面</td>
</tr>
</tbody>
</table>
<h4 id="渠道配置模式">渠道配置模式</h4>
<pre tabindex="0"><code class="language-json5" data-lang="json5">{
  channels: {
    whatsapp: {
      enabled: true,
      dmPolicy: &#34;pairing&#34;,        // pairing, allowlist, open
      allowFrom: [&#34;+15551234567&#34;],
      groups: {
        &#34;*&#34;: { requireMention: true }
      }
    },
    telegram: {
      enabled: true,
      botToken: &#34;${TELEGRAM_BOT_TOKEN}&#34;,
      dmPolicy: &#34;pairing&#34;,
      groups: {
        &#34;*&#34;: { requireMention: true }
      }
    }
  }
}
</code></pre><h4 id="私聊策略">私聊策略</h4>
<table>
<thead>
<tr>
<th>策略</th>
<th>行为</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pairing</code></td>
<td>未知发送者将收到配对码以供审批</td>
</tr>
<tr>
<td><code>allowlist</code></td>
<td>仅 <code>allowFrom</code> 中的号码/ID 可发送消息</td>
</tr>
<tr>
<td><code>open</code></td>
<td>任何人都可发送消息（对工具执行存在风险！）</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="技能">技能</h3>
<p>技能教会 Agent 如何使用工具。OpenClaw 采用与 <a href="https://agentskills.io">AgentSkills</a> 兼容的格式：</p>
<h4 id="技能结构">技能结构</h4>
<pre tabindex="0"><code>skills/
└── my-skill/
    └── SKILL.md
</code></pre><h4 id="skillmd-格式">SKILL.md 格式</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>name: weather
</span></span><span style="display:flex;"><span>description: 获取指定位置的天气预报
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## 使用方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>使用 <span style="color:#e6db74">`weather`</span> 命令获取当前天气状况和预报。
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## 示例
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#e6db74">`weather &#34;San Francisco, CA&#34;`</span>
</span></span></code></pre></div><h4 id="技能优先级">技能优先级</h4>
<ol>
<li><strong>工作区技能</strong>：<code>&lt;workspace&gt;/skills</code>（最高优先级）</li>
<li><strong>托管技能</strong>：<code>~/.openclaw/skills</code></li>
<li><strong>内置技能</strong>：随 OpenClaw 一起发布（最低优先级）</li>
</ol>
<h4 id="技能门控">技能门控</h4>
<p>技能可根据环境、二进制文件或配置条件加载：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># SKILL.md frontmatter</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">macos-only-skill</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">description</span>: <span style="color:#ae81ff">需要 macOS 环境</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>: {<span style="color:#e6db74">&#34;openclaw&#34;</span>:{<span style="color:#e6db74">&#34;requires&#34;</span>:{<span style="color:#e6db74">&#34;platform&#34;</span>:<span style="color:#e6db74">&#34;darwin&#34;</span>,<span style="color:#e6db74">&#34;bins&#34;</span>:[<span style="color:#e6db74">&#34;swift&#34;</span>]}}}
</span></span><span style="display:flex;"><span>---
</span></span></code></pre></div><hr>
<h3 id="节点">节点</h3>
<p>节点是连接到网关的远程设备（macOS、iOS、Android），用于执行设备本地操作：</p>
<h4 id="节点能力">节点能力</h4>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>canvas.*</code></td>
<td>渲染 Agent 驱动的 UI</td>
</tr>
<tr>
<td><code>camera.*</code></td>
<td>拍照、录制视频</td>
</tr>
<tr>
<td><code>screen.record</code></td>
<td>屏幕录制</td>
</tr>
<tr>
<td><code>location.get</code></td>
<td>获取设备位置</td>
</tr>
<tr>
<td><code>system.notify</code></td>
<td>推送通知</td>
</tr>
<tr>
<td><code>system.run</code></td>
<td>执行命令（macOS）</td>
</tr>
</tbody>
</table>
<h4 id="节点架构">节点架构</h4>
<pre tabindex="0"><code>┌────────────────┐     WebSocket      ┌──────────────┐
│      网关      │◄──────────────────►│  macOS 节点  │
│                │                    │  - 相机      │
│  node.invoke   │                    │  - 屏幕      │
│  node.list     │                    │  - 位置      │
│  node.describe │                    │  - system.*  │
└────────────────┘                    └──────────────┘
        ▲
        │
        ▼
┌────────────────┐
│   iOS 节点     │
│   - Canvas     │
│   - 相机       │
│   - 语音       │
└────────────────┘
</code></pre><h4 id="节点配对流程">节点配对流程</h4>
<ol>
<li>节点在 <code>connect</code> 帧中携带 <code>role: &quot;node&quot;</code> 进行连接</li>
<li>网关为未识别的设备返回配对码</li>
<li>操作员审批：<code>openclaw pairing approve &lt;code&gt;</code></li>
<li>节点收到设备令牌，用于后续连接</li>
</ol>
<hr>
<h2 id="通信协议">通信协议</h2>
<p>OpenClaw 使用带强制握手的类型化 WebSocket 协议：</p>
<h3 id="连接生命周期">连接生命周期</h3>
<pre tabindex="0"><code>客户端                          网关
  │                                │
  │── req:connect ────────────────►│
  │                                │  (验证认证、能力)
  │◄────────── res:hello-ok ───────│
  │                                │
  │◄────────── event:presence ─────│
  │◄────────── event:tick ─────────│
  │                                │
  │── req:agent ──────────────────►│
  │◄────────── res:ack ────────────│  (runId, status:accepted)
  │◄────────── event:agent ────────│  (流式传输)
  │◄────────── res:agent ──────────│  (最终：status, summary)
  │                                │
</code></pre><h3 id="消息类型">消息类型</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#75715e">// 请求
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;req&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">id</span>: <span style="color:#66d9ef">string</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">method</span>: <span style="color:#66d9ef">string</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">params</span>: <span style="color:#66d9ef">object</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 响应
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;res&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">id</span>: <span style="color:#66d9ef">string</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ok</span>: <span style="color:#66d9ef">boolean</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">payload?</span>: <span style="color:#66d9ef">object</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">error?</span>: <span style="color:#66d9ef">object</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 事件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;event&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">event</span>: <span style="color:#66d9ef">string</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">payload</span>: <span style="color:#66d9ef">object</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">seq?</span>: <span style="color:#66d9ef">number</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">stateVersion?</span>: <span style="color:#66d9ef">number</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="核心方法">核心方法</h3>
<table>
<thead>
<tr>
<th>方法</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>connect</code></td>
<td>强制首帧，建立会话</td>
</tr>
<tr>
<td><code>agent</code></td>
<td>运行一轮 Agent</td>
</tr>
<tr>
<td><code>agent.wait</code></td>
<td>等待 Agent 完成</td>
</tr>
<tr>
<td><code>send</code></td>
<td>通过活动渠道发送消息</td>
</tr>
<tr>
<td><code>health</code></td>
<td>完整健康快照</td>
</tr>
<tr>
<td><code>status</code></td>
<td>简短摘要</td>
</tr>
<tr>
<td><code>node.list</code></td>
<td>列出已连接/已配对的节点</td>
</tr>
<tr>
<td><code>node.invoke</code></td>
<td>执行节点命令</td>
</tr>
<tr>
<td><code>config.patch</code></td>
<td>部分配置更新 + 重启</td>
</tr>
</tbody>
</table>
<h3 id="认证">认证</h3>
<pre tabindex="0"><code class="language-json5" data-lang="json5">// 带认证的连接帧
{
  type: &#34;req&#34;,
  id: &#34;1&#34;,
  method: &#34;connect&#34;,
  params: {
    minProtocol: 1,
    maxProtocol: 1,
    client: {
      id: &#34;my-client-id&#34;,
      version: &#34;1.0.0&#34;,
      platform: &#34;macos&#34;
    },
    auth: {
      token: &#34;${OPENCLAW_GATEWAY_TOKEN}&#34;  // 非本地回环连接必需
    }
  }
}
</code></pre><hr>
<h2 id="运行时工作流程">运行时工作流程</h2>
<p><img src="https://Lumicreator.github.io/lumi-tech-blog/openclaw-internal-routing.png" alt="路由"></p>
<h3 id="消息流从接收到响应">消息流：从接收到响应</h3>
<pre tabindex="0"><code>1. 消息接收（WhatsApp/Telegram 等）
         │
         ▼
2. 渠道适配器规范化信封
   - 提取发送者、内容、媒体、回复上下文
         │
         ▼
3. 路由确定 Agent 和会话
   - 检查多 Agent 绑定
   - 应用私聊策略（pairing/allowlist/open）
   - 构建会话键
         │
         ▼
4. 会话管理器加载/创建会话
   - 检查重置策略（daily/idle）
   - 加载现有记录（如存在）
         │
         ▼
5. Agent 循环执行
   - 组装系统提示 + 技能
   - 携带上下文调用模型
   - 按需执行工具
   - 流式输出助手响应
         │
         ▼
6. 响应路由发送回复
   - 确定性：返回源渠道
   - 按平台限制分块
   - 处理媒体附件
         │
         ▼
7. 会话持久化记录至 JSONL
</code></pre><h3 id="工具执行流程">工具执行流程</h3>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">stateDiagram-v2
    [*] --&gt; Request: 模型发起工具调用
    Request --&gt; SandboxCheck: 检查沙箱模式
    
    state SandboxCheck {
        direction LR
        Host: 在宿主机运行
        Docker: 在 Docker 沙箱运行
    }
    
    SandboxCheck --&gt; Host: mode=&#34;off&#34;
    SandboxCheck --&gt; Docker: mode=&#34;all&#34; | mode=&#34;non-main&#34;
    
    Host --&gt; Sanitize: 获取执行结果
    Docker --&gt; Sanitize: 获取执行结果
    
    Sanitize --&gt; Stream: 脱敏并实时推流
    Stream --&gt; [*]: 完成并喂回模型
</code></pre><hr>
<h2 id="多-agent-架构">多 Agent 架构</h2>
<p>OpenClaw 支持在单个网关内运行多个隔离的 Agent：</p>
<h3 id="agent-隔离">Agent 隔离</h3>
<p>每个 Agent 拥有：</p>
<ul>
<li><strong>独立工作区</strong>（文件、AGENTS.md、SOUL.md、USER.md）</li>
<li><strong>独立状态目录</strong>（<code>~/.openclaw/agents/&lt;agentId&gt;</code>）</li>
<li><strong>独立会话存储</strong></li>
<li><strong>独立认证配置</strong>（模型凭证）</li>
</ul>
<h3 id="绑定配置">绑定配置</h3>
<pre tabindex="0"><code class="language-json5" data-lang="json5">{
  agents: {
    list: [
      {
        id: &#34;personal&#34;,
        workspace: &#34;~/.openclaw/workspace-personal&#34;,
        default: true
      },
      {
        id: &#34;work&#34;,
        workspace: &#34;~/.openclaw/workspace-work&#34;
      }
    ]
  },
  bindings: [
    // 将特定私聊路由至工作 Agent
    {
      agentId: &#34;work&#34;,
      match: {
        channel: &#34;telegram&#34;,
        peer: { kind: &#34;dm&#34;, id: &#34;123456789&#34; }
      }
    },
    // 将 Discord 服务器路由至工作 Agent
    {
      agentId: &#34;work&#34;,
      match: {
        channel: &#34;discord&#34;,
        guildId: &#34;987654321&#34;
      }
    }
    // 其他流量回落至默认（personal）
  ]
}
</code></pre><h3 id="绑定解析顺序">绑定解析顺序</h3>
<ol>
<li>精确对端匹配（私聊/群组/频道 ID）</li>
<li>服务器 ID（Discord）</li>
<li>团队 ID（Slack）</li>
<li>渠道账号 ID</li>
<li>渠道级匹配</li>
<li>默认 Agent</li>
</ol>
<hr>
<h2 id="安全模型">安全模型</h2>
<h3 id="威胁模型">威胁模型</h3>
<p>运行具有 Shell 访问权限的 AI 助手需要谨慎的安全设计：</p>
<pre tabindex="0"><code>┌────────────────────────────────────────────────────────────┐
│                    威胁面                                   │
│                                                             │
│  入站攻击                                                   │
│  - 消息中的提示注入                                         │
│  - 通过私聊进行社会工程                                     │
│  - 恶意群组成员                                             │
│                                                             │
│  影响范围                                                   │
│  - Shell 命令执行                                           │
│  - 文件系统访问                                             │
│  - 网络访问                                                 │
│  - 凭证暴露                                                 │
└────────────────────────────────────────────────────────────┘
</code></pre><h3 id="防御层级">防御层级</h3>
<ol>
<li><strong>身份优先</strong>：控制谁可以与机器人对话</li>
<li><strong>范围次之</strong>：限制机器人的操作范围</li>
<li><strong>沙箱隔离</strong>：隔离工具执行环境</li>
<li><strong>工具策略</strong>：允许/拒绝特定工具</li>
</ol>
<h3 id="安全审计">安全审计</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 运行安全审计</span>
</span></span><span style="display:flex;"><span>openclaw security audit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 深度审计（包含实时探测）</span>
</span></span><span style="display:flex;"><span>openclaw security audit --deep
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 自动修复常见问题</span>
</span></span><span style="display:flex;"><span>openclaw security audit --fix
</span></span></code></pre></div><h3 id="沙箱配置">沙箱配置</h3>
<pre tabindex="0"><code class="language-json5" data-lang="json5">{
  agents: {
    defaults: {
      sandbox: {
        mode: &#34;non-main&#34;,           // off, non-main, all
        scope: &#34;session&#34;,           // session, agent, shared
        workspaceAccess: &#34;none&#34;,    // none, ro, rw
        docker: {
          network: &#34;none&#34;,          // 禁用网络
          binds: [                  // 自定义挂载
            &#34;/data/shared:/data:ro&#34;
          ]
        }
      }
    }
  }
}
</code></pre><h3 id="凭证存储">凭证存储</h3>
<table>
<thead>
<tr>
<th>凭证</th>
<th>位置</th>
</tr>
</thead>
<tbody>
<tr>
<td>WhatsApp 凭证</td>
<td><code>~/.openclaw/credentials/whatsapp/&lt;accountId&gt;/creds.json</code></td>
</tr>
<tr>
<td>Telegram 令牌</td>
<td>配置文件或环境变量</td>
</tr>
<tr>
<td>模型认证</td>
<td><code>~/.openclaw/agents/&lt;agentId&gt;/agent/auth-profiles.json</code></td>
</tr>
<tr>
<td>配对白名单</td>
<td><code>~/.openclaw/credentials/&lt;channel&gt;-allowFrom.json</code></td>
</tr>
</tbody>
</table>
<hr>
<h2 id="可扩展性">可扩展性</h2>
<h3 id="插件系统">插件系统</h3>
<p>插件通过新渠道、工具和技能扩展 OpenClaw：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 列出插件</span>
</span></span><span style="display:flex;"><span>openclaw plugins list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装插件</span>
</span></span><span style="display:flex;"><span>openclaw plugins install &lt;plugin&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启用/禁用</span>
</span></span><span style="display:flex;"><span>openclaw plugins enable &lt;plugin&gt;
</span></span><span style="display:flex;"><span>openclaw plugins disable &lt;plugin&gt;
</span></span></code></pre></div><h3 id="插件钩子">插件钩子</h3>
<table>
<thead>
<tr>
<th>钩子</th>
<th>时机</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>before_agent_start</code></td>
<td>Agent 轮次开始前</td>
</tr>
<tr>
<td><code>agent_end</code></td>
<td>Agent 完成后</td>
</tr>
<tr>
<td><code>before_tool_call</code></td>
<td>工具执行前</td>
</tr>
<tr>
<td><code>after_tool_call</code></td>
<td>工具执行后</td>
</tr>
<tr>
<td><code>message_received</code></td>
<td>接收入站消息</td>
</tr>
<tr>
<td><code>message_sending</code></td>
<td>发送前</td>
</tr>
<tr>
<td><code>gateway_start</code></td>
<td>网关启动</td>
</tr>
</tbody>
</table>
<h3 id="clawdhub技能注册中心">ClawdHub（技能注册中心）</h3>
<p><a href="https://clawdhub.com">ClawdHub</a> 提供技能发现和安装：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 安装技能</span>
</span></span><span style="display:flex;"><span>clawdhub install weather
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 更新所有技能</span>
</span></span><span style="display:flex;"><span>clawdhub update --all
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 同步本地技能至注册中心</span>
</span></span><span style="display:flex;"><span>clawdhub sync --all
</span></span></code></pre></div><hr>
<h2 id="部署模式">部署模式</h2>
<h3 id="模式-1本地开发">模式 1：本地开发</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 快速开始</span>
</span></span><span style="display:flex;"><span>npm install -g openclaw@latest
</span></span><span style="display:flex;"><span>openclaw onboard --install-daemon
</span></span><span style="display:flex;"><span>openclaw channels login        <span style="color:#75715e"># WhatsApp 扫码</span>
</span></span><span style="display:flex;"><span>openclaw gateway
</span></span></code></pre></div><h3 id="模式-2远程-linux-服务器">模式 2：远程 Linux 服务器</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 在服务器上</span>
</span></span><span style="display:flex;"><span>npm install -g openclaw@latest
</span></span><span style="display:flex;"><span>openclaw onboard --install-daemon
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 通过 SSH 隧道访问</span>
</span></span><span style="display:flex;"><span>ssh -N -L 18789:127.0.0.1:18789 user@server
</span></span></code></pre></div><h3 id="模式-3docker-部署">模式 3：Docker 部署</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 构建和设置</span>
</span></span><span style="display:flex;"><span>./docker-setup.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 手动 compose</span>
</span></span><span style="display:flex;"><span>docker build -t openclaw:local -f Dockerfile .
</span></span><span style="display:flex;"><span>docker compose run --rm openclaw-cli onboard
</span></span><span style="display:flex;"><span>docker compose up -d openclaw-gateway
</span></span></code></pre></div><h3 id="模式-4tailscale-暴露">模式 4：Tailscale 暴露</h3>
<pre tabindex="0"><code class="language-json5" data-lang="json5">{
  gateway: {
    tailscale: {
      mode: &#34;serve&#34;,         // serve（内网）或 funnel（公网）
      resetOnExit: true
    },
    auth: {
      mode: &#34;password&#34;,      // funnel 必需
      password: &#34;${OPENCLAW_GATEWAY_PASSWORD}&#34;
    }
  }
}
</code></pre><h3 id="模式-5多-agent-服务器">模式 5：多 Agent 服务器</h3>
<pre tabindex="0"><code class="language-json5" data-lang="json5">{
  agents: {
    list: [
      { id: &#34;alice&#34;, workspace: &#34;~/.openclaw/workspace-alice&#34; },
      { id: &#34;bob&#34;, workspace: &#34;~/.openclaw/workspace-bob&#34; }
    ]
  },
  channels: {
    whatsapp: {
      accounts: [
        { id: &#34;alice-wa&#34;, name: &#34;Alice&#34; },
        { id: &#34;bob-wa&#34;, name: &#34;Bob&#34; }
      ]
    }
  },
  bindings: [
    { agentId: &#34;alice&#34;, match: { channel: &#34;whatsapp&#34;, accountId: &#34;alice-wa&#34; } },
    { agentId: &#34;bob&#34;, match: { channel: &#34;whatsapp&#34;, accountId: &#34;bob-wa&#34; } }
  ]
}
</code></pre><hr>
<h2 id="cli-参考">CLI 参考</h2>
<h3 id="常用命令">常用命令</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 设置与配置</span>
</span></span><span style="display:flex;"><span>openclaw onboard              <span style="color:#75715e"># 交互式向导</span>
</span></span><span style="display:flex;"><span>openclaw setup                <span style="color:#75715e"># 初始化配置</span>
</span></span><span style="display:flex;"><span>openclaw configure            <span style="color:#75715e"># 设置凭证</span>
</span></span><span style="display:flex;"><span>openclaw doctor               <span style="color:#75715e"># 健康检查 + 修复</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 网关控制</span>
</span></span><span style="display:flex;"><span>openclaw gateway status       <span style="color:#75715e"># 检查网关状态</span>
</span></span><span style="display:flex;"><span>openclaw gateway start        <span style="color:#75715e"># 作为服务启动</span>
</span></span><span style="display:flex;"><span>openclaw gateway stop         <span style="color:#75715e"># 停止服务</span>
</span></span><span style="display:flex;"><span>openclaw gateway restart      <span style="color:#75715e"># 重启服务</span>
</span></span><span style="display:flex;"><span>openclaw gateway --port <span style="color:#ae81ff">18789</span> <span style="color:#75715e"># 前台运行</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 消息</span>
</span></span><span style="display:flex;"><span>openclaw message send --target +1234567890 --message <span style="color:#e6db74">&#34;Hello&#34;</span>
</span></span><span style="display:flex;"><span>openclaw agent --message <span style="color:#e6db74">&#34;今天天气怎么样？&#34;</span> --thinking high
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 会话</span>
</span></span><span style="display:flex;"><span>openclaw sessions             <span style="color:#75715e"># 列出会话</span>
</span></span><span style="display:flex;"><span>openclaw sessions --json      <span style="color:#75715e"># JSON 输出</span>
</span></span><span style="display:flex;"><span>openclaw status               <span style="color:#75715e"># 快速健康检查</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 渠道</span>
</span></span><span style="display:flex;"><span>openclaw channels list        <span style="color:#75715e"># 列出已配置渠道</span>
</span></span><span style="display:flex;"><span>openclaw channels login       <span style="color:#75715e"># 关联 WhatsApp 等</span>
</span></span><span style="display:flex;"><span>openclaw channels status      <span style="color:#75715e"># 渠道健康状况</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 技能</span>
</span></span><span style="display:flex;"><span>openclaw skills list          <span style="color:#75715e"># 列出已加载技能</span>
</span></span><span style="display:flex;"><span>openclaw skills info &lt;name&gt;   <span style="color:#75715e"># 技能详情</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安全</span>
</span></span><span style="display:flex;"><span>openclaw security audit       <span style="color:#75715e"># 运行安全审计</span>
</span></span></code></pre></div><h3 id="应用内聊天命令">应用内聊天命令</h3>
<table>
<thead>
<tr>
<th>命令</th>
<th>操作</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/status</code></td>
<td>会话状态、token 数、模型</td>
</tr>
<tr>
<td><code>/new</code> 或 <code>/reset</code></td>
<td>重置会话</td>
</tr>
<tr>
<td><code>/new &lt;model&gt;</code></td>
<td>使用新模型重置</td>
</tr>
<tr>
<td><code>/compact</code></td>
<td>压缩旧上下文</td>
</tr>
<tr>
<td><code>/think &lt;level&gt;</code></td>
<td>设置思考级别</td>
</tr>
<tr>
<td><code>/stop</code></td>
<td>中止当前运行</td>
</tr>
<tr>
<td><code>/context list</code></td>
<td>显示上下文来源</td>
</tr>
<tr>
<td><code>/send on/off</code></td>
<td>切换消息发送</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="最佳实践">最佳实践</h2>
<h3 id="1-安全优先">1. 安全优先</h3>
<pre tabindex="0"><code class="language-json5" data-lang="json5">{
  channels: {
    whatsapp: {
      dmPolicy: &#34;pairing&#34;,           // 切勿使用 &#34;open&#34;！
      groups: { &#34;*&#34;: { requireMention: true } }
    }
  },
  agents: {
    defaults: {
      sandbox: { mode: &#34;non-main&#34; }  // 群组使用沙箱
    }
  }
}
</code></pre><h3 id="2-使用专用手机号">2. 使用专用手机号</h3>
<p>对于 WhatsApp，建议使用独立号码以避免自聊天的异常行为，并保持路由清晰。</p>
<h3 id="3-工作区组织">3. 工作区组织</h3>
<pre tabindex="0"><code>~/.openclaw/workspace/
├── AGENTS.md           # Agent 指令
├── SOUL.md             # 人格定义
├── USER.md             # 用户上下文
├── TOOLS.md            # 环境特定笔记
├── memory/
│   └── YYYY-MM-DD.md   # 每日日志
├── skills/
│   └── custom-skill/
│       └── SKILL.md
└── canvas/
    └── index.html      # Canvas 内容
</code></pre><h3 id="4-模型选择">4. 模型选择</h3>
<pre tabindex="0"><code class="language-json5" data-lang="json5">{
  agent: {
    model: &#34;anthropic/claude-opus-4-5&#34;,  // 强大的长上下文能力
    thinkingLevel: &#34;low&#34;                 // 平衡速度与质量
  }
}
</code></pre><h3 id="5-会话重置策略">5. 会话重置策略</h3>
<pre tabindex="0"><code class="language-json5" data-lang="json5">{
  session: {
    reset: {
      mode: &#34;daily&#34;,
      atHour: 4         // 每天早晨全新开始
    },
    resetByType: {
      group: { mode: &#34;idle&#34;, idleMinutes: 120 }  // 群组更快重置
    }
  }
}
</code></pre><h3 id="6-监控">6. 监控</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 定期检查健康状况</span>
</span></span><span style="display:flex;"><span>openclaw health
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 监控日志</span>
</span></span><span style="display:flex;"><span>openclaw logs --follow
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 定期运行审计</span>
</span></span><span style="display:flex;"><span>openclaw doctor
</span></span><span style="display:flex;"><span>openclaw security audit
</span></span></code></pre></div><hr>
<h2 id="核心要点">核心要点</h2>
<ol>
<li>
<p><strong>以网关为中心的设计</strong>：单一进程管理所有渠道连接，实现确定性路由和一致的状态管理。</p>
</li>
<li>
<p><strong>协议优先通信</strong>：带 JSON Schema 验证的类型化 WebSocket 协议确保可靠的客户端-服务器交互。</p>
</li>
<li>
<p><strong>分层安全</strong>：身份控制 → 范围限制 → 沙箱隔离 → 工具策略，提供纵深防御。</p>
</li>
<li>
<p><strong>灵活的多 Agent</strong>：绑定机制将消息路由至隔离的 Agent，支持在共享基础设施上运行多个用户或角色。</p>
</li>
<li>
<p><strong>可扩展架构</strong>：技能、插件和钩子支持在不修改核心代码的情况下进行定制。</p>
</li>
<li>
<p><strong>生产就绪运维</strong>：systemd/launchd 集成、热重载、健康检查和安全审计支持可靠部署。</p>
</li>
</ol>
<hr>
<h2 id="未来路线图">未来路线图</h2>
<p>基于当前开发模式和文档，潜在的演进方向包括：</p>
<h3 id="近期">近期</h3>
<ul>
<li><strong>增强 MCP 支持</strong>：更深入的模型上下文协议集成</li>
<li><strong>语音通话技能</strong>：实时语音对话支持</li>
<li><strong>改进沙箱浏览器</strong>：沙箱环境中更好的浏览器自动化</li>
</ul>
<h3 id="中期">中期</h3>
<ul>
<li><strong>联邦</strong>：跨网关 Agent 通信</li>
<li><strong>插件市场</strong>：策划的插件生态系统</li>
<li><strong>企业功能</strong>：SSO、审计日志、合规工具</li>
</ul>
<h3 id="长期">长期</h3>
<ul>
<li><strong>分布式网关</strong>：多节点网关实现高可用</li>
<li><strong>微调集成</strong>：自定义模型训练工作流</li>
<li><strong>Agent 间协议</strong>：标准化的多 Agent 协作</li>
</ul>
<hr>
<h2 id="结语">结语</h2>
<p>OpenClaw 代表了一种精心设计的个人 AI 助手方案——优先考虑本地控制、安全性和可扩展性。其以网关为中心的架构为将 LLM 与真实世界消息系统集成提供了坚实基础，同时保持了运维的简洁性。</p>
<p>对于构建生产级 AI 助手基础设施的开发者而言，OpenClaw 提供了宝贵的模式：协议驱动的通信、纵深防御的安全性，以及渠道、Agent 和工具之间的清晰分离。</p>
<p><strong>开始使用</strong>：<a href="https://github.com/openclaw/openclaw">github.com/openclaw/openclaw</a></p>
<p><strong>文档</strong>：<a href="https://docs.openclaw.ai">docs.openclaw.ai</a></p>
<p><strong>社区</strong>：<a href="https://discord.gg/clawd">Discord</a></p>
<hr>
<p><em>本文通过分析 OpenClaw 代码仓库（项目根目录）和 <code>https://github.com/openclaw/openclaw</code>（版本 2026.1.29）生成。</em></p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/ai" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">AI</a>
   </li>
  
   <li class="list di">
     <a href="/tags/openclaw" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">OpenClaw</a>
   </li>
  
   <li class="list di">
     <a href="/tags/architecture" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Architecture</a>
   </li>
  
   <li class="list di">
     <a href="/tags/gateway" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Gateway</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/lumi-tech-blog/posts/ai-news-2026-01-31/">AI News Daily: 2026-01-31</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://Lumicreator.github.io/lumi-tech-blog/" >
    &copy;  Lumi's Tech Blog 2026 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
